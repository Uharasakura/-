<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>像素种田生活 - 响应式改造</title>
  <style>
    :root {
      --main-bg-dark: #1a2f1a;
      --main-bg-light: #2c4a2c;
      --text-color: #9ab973;
      --border-color: #4a5f3c;
      --highlight: #c5d6a2;
      --button-bg: #3d4f32;
      --button-hover: #4d633f;
      --container-bg: rgba(26, 47, 26, 0.6);
      --font-family: 'Press Start 2P', monospace;
    }

    /* 重置 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: var(--font-family);
      color: var(--text-color);
    }

    html, body {
      height: 100%;
      background: linear-gradient(135deg, var(--main-bg-dark), var(--main-bg-light));
      padding: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #game-container {
      display: flex;
      flex-direction: column;
      width: 90vw;
      max-width: 800px;
      height: 80vh;
      background: var(--container-bg);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      user-select: none;
    }

    /* 状态栏 */
    #status-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 10px;
      font-size: 1.1rem;
      text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
    }

    .status-item {
      flex: 1 1 100px;
      min-width: 80px;
    }

    /* 文字故事区域 - 关键撑满剩余空间，支持滚动 */
    #story-text {
      flex-grow: 1;
      margin: 14px 0;
      padding: 12px;
      background: linear-gradient(180deg, rgba(26,47,26,0.6), rgba(44,74,44,0.6));
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--highlight);
      font-size: 1rem;
      line-height: 1.5;
      overflow-y: auto;
      text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
      white-space: pre-wrap;
    }

    /* 按钮区域 */
    #choices {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }

    .choice-btn {
      flex: 1 1 45%;
      min-width: 140px;
      padding: 14px 16px;
      background: linear-gradient(90deg, var(--button-bg), rgba(61,79,50,0.9));
      border: 1px solid var(--border-color);
      color: var(--text-color);
      cursor: pointer;
      border-radius: 6px;
      font-size: 1rem;
      text-align: center;
      text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
      transition: all 0.25s ease;
      user-select: none;
    }

    .choice-btn:hover {
      background: linear-gradient(90deg, var(--button-hover), rgba(77,99,63,0.9));
      color: var(--highlight);
      transform: translateX(5px);
    }

    /* 响应式微调 */
    @media (max-width: 600px) {
      #choices {
        gap: 8px;
      }
      .choice-btn {
        flex: 1 1 100%;
        min-width: unset;
      }
      #status-bar {
        font-size: 0.9rem;
      }
      #story-text {
        font-size: 0.9rem;
      }
    }

    @media (max-height: 500px) {
      #game-container {
        height: 90vh;
      }
      #story-text {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="status-bar">
      <div class="status-item">体力: <span id="energy">100</span></div>
      <div class="status-item">金币: <span id="money">100</span></div>
      <div class="status-item">季节: <span id="season">春</span></div>
      <div class="status-item">天数: <span id="day">1</span></div>
    </div>
    <div id="story-text" tabindex="0">
      这是你的农田。目前杂草丛生，需要清理后才能开始耕种。你可以种植不同的作物，每种作物的生长周期和收益都不同：  
      - 萝卜：种植5金币，5天成熟，售价15金币  
      - 白菜：种植10金币，7天成熟，售价25金币  
      - 土豆：种植15金币，10天成熟，售价40金币
    </div>
    <div id="choices">
      <button class="choice-btn" onclick="makeChoice('clear')">清理土地 (-20体力)</button>
      <button class="choice-btn" onclick="makeChoice('plant')">种植作物 (-10体力)</button>
      <button class="choice-btn" onclick="makeChoice('water')">浇水 (-5体力)</button>
      <button class="choice-btn" onclick="makeChoice('harvest')">收获作物 (-10体力)</button>
      <button class="choice-btn" onclick="makeChoice('rest')">休息 (+30体力)</button>
      <button class="choice-btn" onclick="makeChoice('nextDay')">结束当天</button>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(function () {
      // 你的游戏逻辑写这里，和你之前差不多，只是UI用上面布局
      let gameState = {
        energy: 100,
        money: 100,
        season: '春',
        day: 1,
        crops: [],
        maxCrops: 4,
        clearedLand: 0,
        cropTypes: {
          carrot: { name: '萝卜', growthTime: 5, price: 15, cost: 5 },
          cabbage: { name: '白菜', growthTime: 7, price: 25, cost: 10 },
          potato: { name: '土豆', growthTime: 10, price: 40, cost: 15 },
        },
      };

      function updateStatus() {
        $('#energy').text(gameState.energy);
        $('#money').text(gameState.money);
        $('#season').text(gameState.season);
        $('#day').text(gameState.day);
      }

      function showMainMenu() {
        $('#choices').html(`
          <button class="choice-btn" onclick="makeChoice('clear')">清理土地 (-20体力)</button>
          <button class="choice-btn" onclick="makeChoice('plant')">种植作物 (-10体力)</button>
          <button class="choice-btn" onclick="makeChoice('water')">浇水 (-5体力)</button>
          <button class="choice-btn" onclick="makeChoice('harvest')">收获作物 (-10体力)</button>
          <button class="choice-btn" onclick="makeChoice('rest')">休息 (+30体力)</button>
          <button class="choice-btn" onclick="makeChoice('nextDay')">结束当天</button>
        `);
      }

      window.makeChoice = function (action) {
        switch (action) {
          case 'clear':
            if (gameState.energy >= 20 && gameState.clearedLand < gameState.maxCrops) {
              gameState.energy -= 20;
              gameState.clearedLand++;
              $('#story-text').html(`你清理了一块土地！<br>已清理的土地：${gameState.clearedLand}/${gameState.maxCrops}块`);
            } else if (gameState.clearedLand >= gameState.maxCrops) {
              $('#story-text').text('所有土地都已经清理完毕了！');
            } else {
              $('#story-text').text('体力不足，需要休息！');
            }
            break;

          case 'plant':
            if (gameState.clearedLand > 0 && gameState.energy >= 10) {
              let plantMenu = `
                <div>选择要种植的作物：</div>
                <button class="choice-btn" onclick="plantCrop('carrot')">种植萝卜 (5金币)</button>
                <button class="choice-btn" onclick="plantCrop('cabbage')">种植白菜 (10金币)</button>
                <button class="choice-btn" onclick="plantCrop('potato')">种植土豆 (15金币)</button>
                <button class="choice-btn" onclick="showMainMenu()">取消</button>
              `;
              $('#choices').html(plantMenu);
              $('#story-text').text('请选择作物种类');
            } else if (gameState.clearedLand === 0) {
              $('#story-text').text('需要先清理土地才能种植！');
            } else {
              $('#story-text').text('体力不足，需要休息！');
            }
            break;

          case 'water':
            if (gameState.energy >= 5 && gameState.crops.length > 0) {
              gameState.energy -= 5;
              gameState.crops.forEach(crop => {
                crop.watered = true;
              });
              $('#story-text').text('你给所有作物都浇了水！');
            } else if (gameState.crops.length === 0) {
              $('#story-text').text('没有需要浇水的作物！');
            } else {
              $('#story-text').text('体力不足，需要休息！');
            }
            break;

          case 'harvest':
            if (gameState.energy >= 10) {
              let harvestedCount = 0;
              gameState.crops = gameState.crops.filter(crop => {
                if (crop.daysGrown >= gameState.cropTypes[crop.type].growthTime) {
                  harvestedCount++;
                  gameState.money += gameState.cropTypes[crop.type].price;
                  return false;
                }
                return true;
              });
              if (harvestedCount > 0) {
                gameState.energy -= 10;
                $('#story-text').text(`收获了${harvestedCount}个作物！`);
              } else {
                $('#story-text').text('没有可以收获的作物！');
              }
            } else {
              $('#story-text').text('体力不足，需要休息！');
            }
            break;

          case 'rest':
            gameState.energy = Math.min(100, gameState.energy + 30);
            $('#story-text').text('休息后恢复了一些体力！');
            break;

          case 'nextDay':
            gameState.day++;
            gameState.energy = 100;
            // 作物生长更新
            gameState.crops.forEach(crop => {
              if (crop.watered) {
                crop.daysGrown++;
                crop.watered = false;
              }
            });
            updateCropStatus();
            break;
        }
        updateStatus();
      };

      window.plantCrop = function (cropType) {
        const cost = gameState.cropTypes[cropType].cost;
        if (gameState.money >= cost) {
          gameState.money -= cost;
          gameState.energy -= 10;
          gameState.crops.push({
            type: cropType,
            daysGrown: 0,
            watered: false,
          });
          $('#story-text').text(`种下了一颗${gameState.cropTypes[cropType].name}！`);
          showMainMenu();
        } else {
          $('#story-text').text('金币不足！');
        }
        updateStatus();
      };

      function updateCropStatus() {
        if (gameState.crops.length === 0) {
          $('#story-text').text('当前没有正在生长的作物。');
          return;
        }
        let status = '当前农田状态：\n';
        gameState.crops.forEach(crop => {
          const c = gameState.cropTypes[crop.type];
          status += `${c.name}: 已生长${crop.daysGrown}/${c.growthTime}天 ${crop.watered ? '(已浇水)' : '(未浇水)'}\n`;
        });
        $('#story-text').text(status);
      }

      updateStatus();
    });
  </script>
</body>
</html>
