<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åƒç´ å†œåœºæ¨¡æ‹Ÿå™¨</title>
    <style>
      @font-face {
        font-family: 'PixelFont';
        src: url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
      }

      :root {
        --main-bg-dark: #1a2f1a;
        --main-bg-light: #2c4a2c;
        --text-color: #9ab973;
        --border-color: #4a5f3c;
        --highlight: #c5d6a2;
        --button-bg: #3d4f32;
        --button-hover: #4d633f;
        --container-bg: rgba(26, 47, 26, 0.6);

        /* å†œç”°é¢œè‰² */
        --soil-brown: #8b4513;
        --soil-dark: #654321;
        --grass-green: #228b22;
        --crop-carrot: #ff6347;
        --crop-cabbage: #32cd32;
        --crop-potato: #deb887;
        --water-blue: #4169e1;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'PixelFont', monospace;
      }

      body {
        background: linear-gradient(135deg, var(--main-bg-dark) 0%, var(--main-bg-light) 100%);
        color: var(--text-color);
        padding: min(20px, 3vmin);
        line-height: 1.6;
        min-height: 100vh;
        font-size: min(14px, 2.2vmin);
      }

      #game-container {
        width: min(95vw, 800px);
        margin: 0 auto;
        background: linear-gradient(180deg, var(--container-bg) 0%, rgba(26, 47, 26, 0.8) 100%);
        padding: min(20px, 3vmin);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
      }

      #status-bar {
        display: flex;
        flex-wrap: wrap;
        gap: min(20px, 3vmin);
        margin-bottom: min(20px, 3vmin);
        padding: min(10px, 1.5vmin);
        background: linear-gradient(90deg, rgba(26, 47, 26, 0.8) 0%, rgba(44, 74, 44, 0.8) 100%);
        border: 1px solid var(--border-color);
        border-radius: 4px;
      }

      .status-item {
        font-size: min(14px, 2.2vmin);
        text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
        flex: 1 1 auto;
        min-width: min(80px, 12vmin);
      }

      /* å†œç”°å¯è§†åŒ–åŒºåŸŸ */
      #farm-visual {
        min-height: min(250px, 35vmin);
        margin-bottom: min(20px, 3vmin);
        padding: min(15px, 2.5vmin);
        background: linear-gradient(180deg, rgba(26, 47, 26, 0.6) 0%, rgba(44, 74, 44, 0.6) 100%);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        position: relative;
        overflow: hidden;
      }

      #farm-svg {
        width: 100%;
        height: 100%;
        min-height: min(220px, 30vmin);
        shape-rendering: crispEdges;
      }

      /* å†œç”°ç½‘æ ¼æ ·å¼ */
      .field-plot {
        fill: var(--soil-brown);
        stroke: var(--soil-dark);
        stroke-width: 2;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .field-plot:hover {
        fill: var(--soil-dark);
        stroke-width: 3;
      }

      .field-plot.cleared {
        fill: var(--soil-dark);
      }

      .field-plot.planted {
        fill: var(--grass-green);
      }

      /* ä½œç‰©å›¾æ ‡ */
      .crop-icon {
        pointer-events: none;
      }

      .crop-carrot {
        fill: var(--crop-carrot);
      }

      .crop-cabbage {
        fill: var(--crop-cabbage);
      }

      .crop-potato {
        fill: var(--crop-potato);
      }

      /* æ°´æ»´æ•ˆæœ */
      .water-drop {
        fill: var(--water-blue);
        opacity: 0.7;
        animation: water-glow 2s infinite;
      }

      @keyframes water-glow {
        0%,
        100% {
          opacity: 0.3;
        }
        50% {
          opacity: 0.8;
        }
      }

      /* ä¿¡æ¯æç¤º */
      #info-display {
        position: absolute;
        bottom: min(10px, 1.5vmin);
        left: min(15px, 2.5vmin);
        right: min(15px, 2.5vmin);
        background: rgba(0, 0, 0, 0.7);
        color: var(--highlight);
        padding: min(8px, 1.2vmin);
        border-radius: 4px;
        font-size: min(12px, 1.8vmin);
        text-align: center;
        border: 1px solid var(--border-color);
      }

      #choices {
        display: flex;
        flex-direction: column;
        gap: min(10px, 1.5vmin);
      }

      .choice-btn {
        background: linear-gradient(90deg, var(--button-bg) 0%, rgba(61, 79, 50, 0.9) 100%);
        border: 1px solid var(--border-color);
        color: var(--text-color);
        padding: min(12px, 2vmin) min(15px, 2.5vmin);
        cursor: pointer;
        text-align: left;
        transition: all 0.3s ease;
        border-radius: 4px;
        text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
        font-size: min(14px, 2.2vmin);
      }

      .choice-btn:hover {
        background: linear-gradient(90deg, var(--button-hover) 0%, rgba(77, 99, 63, 0.9) 100%);
        color: var(--highlight);
        transform: translateX(5px);
      }

      .choice-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .pixel-border {
        border-style: solid;
        border-width: 2px;
        border-color: var(--border-color);
      }

      /* ä½œç‰©é€‰æ‹©å¼¹çª— */
      #crop-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal-content {
        background: linear-gradient(180deg, var(--container-bg) 0%, rgba(26, 47, 26, 0.9) 100%);
        padding: min(20px, 3vmin);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        max-width: min(400px, 90vw);
        text-align: center;
      }

      .crop-selection {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(min(120px, 20vmin), 1fr));
        gap: min(15px, 2vmin);
        margin: min(15px, 2vmin) 0;
      }

      .crop-option {
        background: var(--button-bg);
        border: 1px solid var(--border-color);
        padding: min(15px, 2.5vmin);
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
      }

      .crop-option:hover {
        background: var(--button-hover);
        transform: translateY(-2px);
      }

      .crop-icon-large {
        font-size: min(24px, 4vmin);
        margin-bottom: min(8px, 1.2vmin);
        display: block;
      }

      .crop-name {
        font-size: min(12px, 1.8vmin);
        margin-bottom: min(4px, 0.6vmin);
      }

      .crop-cost {
        font-size: min(10px, 1.5vmin);
        color: var(--highlight);
      }
    </style>
  </head>
  <body>
    <div id="game-container" class="pixel-border">
      <div id="status-bar" class="pixel-border">
        <div class="status-item">ä½“åŠ›: <span id="energy">100</span></div>
        <div class="status-item">é‡‘å¸: <span id="money">100</span></div>
        <div class="status-item">å­£èŠ‚: <span id="season">æ˜¥</span></div>
        <div class="status-item">å¤©æ•°: <span id="day">1</span></div>
      </div>

      <div id="farm-visual" class="pixel-border">
        <svg id="farm-svg" viewBox="0 0 400 200">
          <!-- å†œç”°èƒŒæ™¯ -->
          <rect width="400" height="200" fill="#2F4F2F" />

          <!-- 4x2 å†œç”°ç½‘æ ¼ -->
          <g id="farm-grid">
            <!-- ç¬¬ä¸€è¡Œ -->
            <rect class="field-plot" id="plot-0" x="20" y="20" width="80" height="80" data-plot="0" />
            <rect class="field-plot" id="plot-1" x="120" y="20" width="80" height="80" data-plot="1" />
            <rect class="field-plot" id="plot-2" x="220" y="20" width="80" height="80" data-plot="2" />
            <rect class="field-plot" id="plot-3" x="320" y="20" width="80" height="80" data-plot="3" />

            <!-- ç¬¬äºŒè¡Œ -->
            <rect class="field-plot" id="plot-4" x="20" y="120" width="80" height="80" data-plot="4" />
            <rect class="field-plot" id="plot-5" x="120" y="120" width="80" height="80" data-plot="5" />
            <rect class="field-plot" id="plot-6" x="220" y="120" width="80" height="80" data-plot="6" />
            <rect class="field-plot" id="plot-7" x="320" y="120" width="80" height="80" data-plot="7" />
          </g>

          <!-- ä½œç‰©å’Œè£…é¥°å±‚ -->
          <g id="crops-layer"></g>
          <g id="effects-layer"></g>
        </svg>

        <div id="info-display">ç‚¹å‡»å†œç”°æ ¼å­è¿›è¡Œæ“ä½œã€‚å…ˆæ¸…ç†åœŸåœ°ï¼Œç„¶åç§æ¤ä½œç‰©ï¼</div>
      </div>

      <div id="choices" class="pixel-border">
        <button class="choice-btn" onclick="showHelp()">ğŸ“– æŸ¥çœ‹ä½œç‰©ä¿¡æ¯</button>
        <button class="choice-btn" onclick="makeChoice('water')">ğŸ’§ æµ‡æ°´ (-5ä½“åŠ›)</button>
        <button class="choice-btn" onclick="makeChoice('harvest')">ğŸŒ¾ æ”¶è·æˆç†Ÿä½œç‰© (-10ä½“åŠ›)</button>
        <button class="choice-btn" onclick="makeChoice('rest')">ğŸ˜´ ä¼‘æ¯ (+30ä½“åŠ›)</button>
        <button class="choice-btn" onclick="makeChoice('nextDay')">ğŸŒ… ç»“æŸå½“å¤©</button>
      </div>
    </div>

    <!-- ä½œç‰©é€‰æ‹©å¼¹çª— -->
    <div id="crop-modal">
      <div class="modal-content">
        <h3 style="color: var(--highlight); margin-bottom: min(15px, 2vmin)">é€‰æ‹©è¦ç§æ¤çš„ä½œç‰©</h3>
        <div class="crop-selection">
          <div class="crop-option" onclick="selectCrop('carrot')">
            <span class="crop-icon-large">ğŸ¥•</span>
            <div class="crop-name">èåœ</div>
            <div class="crop-cost">5é‡‘å¸ | 5å¤©</div>
          </div>
          <div class="crop-option" onclick="selectCrop('cabbage')">
            <span class="crop-icon-large">ğŸ¥¬</span>
            <div class="crop-name">ç™½èœ</div>
            <div class="crop-cost">10é‡‘å¸ | 7å¤©</div>
          </div>
          <div class="crop-option" onclick="selectCrop('potato')">
            <span class="crop-icon-large">ğŸ¥”</span>
            <div class="crop-name">åœŸè±†</div>
            <div class="crop-cost">15é‡‘å¸ | 10å¤©</div>
          </div>
        </div>
        <button class="choice-btn" onclick="closeCropModal()" style="margin-top: min(15px, 2vmin)">å–æ¶ˆ</button>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
          energy: 100,
          money: 100,
          season: 'æ˜¥',
          day: 1,
          plots: Array(8)
            .fill()
            .map(() => ({
              cleared: false,
              crop: null,
              daysGrown: 0,
              watered: false,
            })),
          cropTypes: {
            carrot: { name: 'èåœ', growthTime: 5, price: 15, cost: 5, icon: 'ğŸ¥•', color: 'crop-carrot' },
            cabbage: { name: 'ç™½èœ', growthTime: 7, price: 25, cost: 10, icon: 'ğŸ¥¬', color: 'crop-cabbage' },
            potato: { name: 'åœŸè±†', growthTime: 10, price: 40, cost: 15, icon: 'ğŸ¥”', color: 'crop-potato' },
          },
          selectedPlot: -1,
        };

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
          $('#energy').text(gameState.energy);
          $('#money').text(gameState.money);
          $('#season').text(gameState.season);
          $('#day').text(gameState.day);
        }

        // æ›´æ–°å†œç”°æ˜¾ç¤º
        function updateFarmDisplay() {
          const cropsLayer = document.getElementById('crops-layer');
          const effectsLayer = document.getElementById('effects-layer');

          // æ¸…ç©ºå›¾å±‚
          cropsLayer.innerHTML = '';
          effectsLayer.innerHTML = '';

          gameState.plots.forEach((plot, index) => {
            const plotElement = document.getElementById(`plot-${index}`);
            const x = 20 + (index % 4) * 100;
            const y = 20 + Math.floor(index / 4) * 100;

            // æ›´æ–°åœ°å—çŠ¶æ€
            plotElement.className = 'field-plot';
            if (plot.cleared) {
              plotElement.classList.add('cleared');
              if (plot.crop) {
                plotElement.classList.add('planted');
              }
            }

            // ç»˜åˆ¶ä½œç‰©
            if (plot.crop) {
              const cropType = gameState.cropTypes[plot.crop];
              const growthProgress = plot.daysGrown / cropType.growthTime;
              const size = Math.max(20, 40 * growthProgress);
              const mature = plot.daysGrown >= cropType.growthTime;

              // ä½œç‰©åŸºç¡€å½¢çŠ¶
              const cropGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
              cropGroup.classList.add('crop-icon');

              // ä½œç‰©ä¸»ä½“ (ç®€åŒ–çš„åƒç´ é£æ ¼)
              const cropBody = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
              cropBody.setAttribute('x', x + 40 - size / 2);
              cropBody.setAttribute('y', y + 60 - size / 2);
              cropBody.setAttribute('width', size);
              cropBody.setAttribute('height', size / 2);
              cropBody.classList.add(cropType.color);

              // æˆç†Ÿå‘å…‰æ•ˆæœ
              if (mature) {
                cropBody.style.filter = 'drop-shadow(0 0 5px gold)';
              }

              cropGroup.appendChild(cropBody);

              // ä½œç‰©èŒå¶
              const stem = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
              stem.setAttribute('x', x + 38);
              stem.setAttribute('y', y + 40);
              stem.setAttribute('width', 4);
              stem.setAttribute('height', 20);
              stem.setAttribute('fill', '#228B22');
              cropGroup.appendChild(stem);

              cropsLayer.appendChild(cropGroup);

              // æµ‡æ°´æ•ˆæœ
              if (plot.watered) {
                const waterDrop = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                waterDrop.setAttribute('cx', x + 65);
                waterDrop.setAttribute('cy', y + 35);
                waterDrop.setAttribute('r', 3);
                waterDrop.classList.add('water-drop');
                effectsLayer.appendChild(waterDrop);
              }
            }
          });
        }

        // å¤„ç†å†œç”°ç‚¹å‡»
        $('.field-plot').click(function () {
          const plotIndex = parseInt($(this).data('plot'));
          const plot = gameState.plots[plotIndex];

          if (!plot.cleared) {
            // æ¸…ç†åœŸåœ°
            if (gameState.energy >= 20) {
              gameState.energy -= 20;
              plot.cleared = true;
              updateInfo(`æ¸…ç†äº†ç¬¬${plotIndex + 1}å—åœŸåœ°ï¼`);
              updateFarmDisplay();
              updateStatus();
            } else {
              updateInfo('ä½“åŠ›ä¸è¶³ï¼Œéœ€è¦ä¼‘æ¯ï¼');
            }
          } else if (!plot.crop) {
            // ç§æ¤ä½œç‰©
            if (gameState.energy >= 10) {
              gameState.selectedPlot = plotIndex;
              $('#crop-modal').show();
            } else {
              updateInfo('ä½“åŠ›ä¸è¶³ï¼Œéœ€è¦ä¼‘æ¯ï¼');
            }
          } else {
            // æ˜¾ç¤ºä½œç‰©ä¿¡æ¯
            const cropType = gameState.cropTypes[plot.crop];
            const daysLeft = Math.max(0, cropType.growthTime - plot.daysGrown);
            const status = plot.daysGrown >= cropType.growthTime ? 'å·²æˆç†Ÿï¼' : `è¿˜éœ€${daysLeft}å¤©æˆç†Ÿ`;
            const waterStatus = plot.watered ? 'å·²æµ‡æ°´' : 'æœªæµ‡æ°´';
            updateInfo(`${cropType.name}: ${status} (${waterStatus})`);
          }
        });

        // é€‰æ‹©ä½œç‰©ç§æ¤
        window.selectCrop = function (cropType) {
          const cost = gameState.cropTypes[cropType].cost;
          if (gameState.money >= cost) {
            gameState.money -= cost;
            gameState.energy -= 10;
            const plot = gameState.plots[gameState.selectedPlot];
            plot.crop = cropType;
            plot.daysGrown = 0;
            plot.watered = false;

            updateInfo(`ç§ä¸‹äº†${gameState.cropTypes[cropType].name}ï¼`);
            updateFarmDisplay();
            updateStatus();
            closeCropModal();
          } else {
            updateInfo('é‡‘å¸ä¸è¶³ï¼');
          }
        };

        // å…³é—­ä½œç‰©é€‰æ‹©å¼¹çª—
        window.closeCropModal = function () {
          $('#crop-modal').hide();
          gameState.selectedPlot = -1;
        };

        // æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
        window.showHelp = function () {
          let helpText = 'ä½œç‰©ä¿¡æ¯ï¼š<br>';
          Object.values(gameState.cropTypes).forEach(crop => {
            helpText += `${crop.icon} ${crop.name}: ${crop.cost}é‡‘å¸, ${crop.growthTime}å¤©æˆç†Ÿ, å”®ä»·${crop.price}é‡‘å¸<br>`;
          });
          updateInfo(helpText);
        };

        // æ›´æ–°ä¿¡æ¯æ˜¾ç¤º
        function updateInfo(message) {
          $('#info-display').html(message);
        }

        // å¤„ç†é€‰æ‹©
        window.makeChoice = function (action) {
          switch (action) {
            case 'water':
              if (gameState.energy >= 5) {
                let wateredCount = 0;
                gameState.plots.forEach(plot => {
                  if (plot.crop && !plot.watered) {
                    plot.watered = true;
                    wateredCount++;
                  }
                });
                if (wateredCount > 0) {
                  gameState.energy -= 5;
                  updateInfo(`ç»™${wateredCount}å—å†œç”°æµ‡äº†æ°´ï¼`);
                  updateFarmDisplay();
                } else {
                  updateInfo('æ²¡æœ‰éœ€è¦æµ‡æ°´çš„ä½œç‰©ï¼');
                }
              } else {
                updateInfo('ä½“åŠ›ä¸è¶³ï¼Œéœ€è¦ä¼‘æ¯ï¼');
              }
              break;

            case 'harvest':
              if (gameState.energy >= 10) {
                let harvestedCount = 0;
                let totalEarnings = 0;
                gameState.plots.forEach(plot => {
                  if (plot.crop && plot.daysGrown >= gameState.cropTypes[plot.crop].growthTime) {
                    harvestedCount++;
                    totalEarnings += gameState.cropTypes[plot.crop].price;
                    plot.crop = null;
                    plot.daysGrown = 0;
                    plot.watered = false;
                  }
                });
                if (harvestedCount > 0) {
                  gameState.energy -= 10;
                  gameState.money += totalEarnings;
                  updateInfo(`æ”¶è·äº†${harvestedCount}ä¸ªä½œç‰©ï¼Œè·å¾—${totalEarnings}é‡‘å¸ï¼`);
                  updateFarmDisplay();
                } else {
                  updateInfo('æ²¡æœ‰å¯ä»¥æ”¶è·çš„ä½œç‰©ï¼');
                }
              } else {
                updateInfo('ä½“åŠ›ä¸è¶³ï¼Œéœ€è¦ä¼‘æ¯ï¼');
              }
              break;

            case 'rest':
              gameState.energy = Math.min(100, gameState.energy + 30);
              updateInfo('ä¼‘æ¯åæ¢å¤äº†30ç‚¹ä½“åŠ›ï¼');
              break;

            case 'nextDay':
              gameState.day++;
              gameState.energy = 100;
              // æ›´æ–°ä½œç‰©ç”Ÿé•¿çŠ¶æ€
              gameState.plots.forEach(plot => {
                if (plot.crop && plot.watered) {
                  plot.daysGrown++;
                  plot.watered = false;
                }
              });
              updateInfo(`ç¬¬${gameState.day}å¤©å¼€å§‹äº†ï¼`);
              updateFarmDisplay();
              break;
          }
          updateStatus();
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        updateStatus();
        updateFarmDisplay();
        updateInfo('æ¬¢è¿æ¥åˆ°åƒç´ å†œåœºï¼ç‚¹å‡»å†œç”°æ ¼å­å¼€å§‹æ¸…ç†åœŸåœ°å§ï¼');
      });
    </script>
  </body>
</html>
