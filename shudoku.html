<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>护眼数独</title>
    <style>
      :root {
        --cell-size: clamp(30px, 8vw, 50px);
        --font-size-small: clamp(12px, 2.5vw, 14px);
        --font-size-normal: clamp(14px, 3vw, 16px);
        --font-size-large: clamp(18px, 4vw, 20px);
        --font-size-xlarge: clamp(20px, 5vw, 24px);
        --spacing-small: clamp(5px, 1.5vw, 8px);
        --spacing-normal: clamp(8px, 2vw, 10px);
        --spacing-large: clamp(15px, 3vw, 20px);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background-color: #f0f2eb;
        font-family: 'Arial', sans-serif;
        color: #2c3338;
        padding: var(--spacing-normal);
      }

      .game-container {
        background-color: #e8ede1;
        padding: var(--spacing-large);
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        width: min(95%, 600px);
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: var(--spacing-large);
      }

      .header h1 {
        color: #4a5568;
        margin-bottom: var(--spacing-normal);
        font-size: var(--font-size-xlarge);
      }

      .controls {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: var(--spacing-large);
        gap: var(--spacing-normal);
      }

      button {
        padding: var(--spacing-small) var(--spacing-normal);
        background-color: #d5e0c9;
        border: none;
        border-radius: 6px;
        color: #2c3338;
        cursor: pointer;
        font-size: var(--font-size-small);
        transition: background-color 0.2s;
        white-space: nowrap;
      }

      button:hover {
        background-color: #c7d4b7;
      }

      .difficulty-select {
        padding: var(--spacing-small);
        border: 1px solid #d5e0c9;
        border-radius: 6px;
        background-color: #fff;
        color: #2c3338;
        font-size: var(--font-size-small);
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(9, var(--cell-size));
        gap: 1px;
        background-color: #b8c4a4;
        padding: 2px;
        border-radius: 8px;
        margin: 0 auto;
        max-width: 100%;
        overflow: auto;
      }

      .cell {
        width: var(--cell-size);
        height: var(--cell-size);
        background-color: #f5f7f2;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--font-size-large);
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .cell:hover:not(.fixed) {
        background-color: #e8ede1;
      }

      .cell.fixed {
        color: #4a5568;
        background-color: #e8ede1;
      }

      .cell.selected {
        background-color: #d5e0c9;
      }

      .cell.error {
        color: #e53e3e;
      }

      /* 3x3宫格边框 */
      .cell:nth-child(9n + 1),
      .cell:nth-child(9n + 2),
      .cell:nth-child(9n + 3) {
        border-left: 2px solid #b8c4a4;
      }
      .cell:nth-child(n + 1):nth-child(-n + 9),
      .cell:nth-child(n + 28):nth-child(-n + 36),
      .cell:nth-child(n + 55):nth-child(-n + 63) {
        border-top: 2px solid #b8c4a4;
      }

      .number-pad {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: var(--spacing-normal);
        margin-top: var(--spacing-large);
        padding: var(--spacing-normal);
        background-color: #e8ede1;
        border-radius: 8px;
        width: 100%;
      }

      .number-btn {
        padding: var(--spacing-normal);
        background-color: #d5e0c9;
        border: none;
        border-radius: 6px;
        font-size: var(--font-size-large);
        color: #2c3338;
        cursor: pointer;
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .number-btn:hover {
        background-color: #c7d4b7;
      }

      .timer {
        font-size: var(--font-size-large);
        color: #4a5568;
        margin: var(--spacing-normal) 0;
      }

      .message {
        margin-top: var(--spacing-large);
        padding: var(--spacing-normal);
        border-radius: 6px;
        text-align: center;
        display: none;
        font-size: var(--font-size-normal);
      }

      .message.success {
        background-color: #c6f6d5;
        color: #2f855a;
      }

      .message.error {
        background-color: #fed7d7;
        color: #c53030;
      }

      @media (max-width: 480px) {
        :root {
          --cell-size: clamp(25px, 9vw, 35px);
          --font-size-small: clamp(10px, 3vw, 12px);
          --font-size-normal: clamp(12px, 3.5vw, 14px);
          --font-size-large: clamp(14px, 4vw, 16px);
          --font-size-xlarge: clamp(16px, 4.5vw, 18px);
          --spacing-small: 4px;
          --spacing-normal: 6px;
          --spacing-large: 12px;
        }

        .game-container {
          padding: var(--spacing-normal);
          width: 98%;
        }

        .controls {
          gap: var(--spacing-small);
        }

        .number-pad {
          gap: var(--spacing-small);
          padding: var(--spacing-small);
        }

        .number-btn {
          padding: var(--spacing-small);
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <div class="header">
        <h1>护眼数独</h1>
        <div class="timer" id="timer">00:00</div>
      </div>
      <div class="controls">
        <select class="difficulty-select" id="difficulty">
          <option value="easy">简单</option>
          <option value="medium">中等</option>
          <option value="hard">困难</option>
        </select>
        <button onclick="newGame()">新游戏</button>
        <button onclick="checkSolution()">检查</button>
        <button onclick="showSolution()">显示答案</button>
      </div>
      <div class="grid" id="grid"></div>
      <div class="number-pad">
        <button class="number-btn" onclick="setNumber(1)">1</button>
        <button class="number-btn" onclick="setNumber(2)">2</button>
        <button class="number-btn" onclick="setNumber(3)">3</button>
        <button class="number-btn" onclick="setNumber(4)">4</button>
        <button class="number-btn" onclick="setNumber(5)">5</button>
        <button class="number-btn" onclick="setNumber(6)">6</button>
        <button class="number-btn" onclick="setNumber(7)">7</button>
        <button class="number-btn" onclick="setNumber(8)">8</button>
        <button class="number-btn" onclick="setNumber(9)">9</button>
        <button class="number-btn" onclick="setNumber(0)">清除</button>
      </div>
      <div class="message" id="message"></div>
    </div>

    <script>
      let grid = [];
      let solution = [];
      let selectedCell = null;
      let timer = 0;
      let timerInterval;
      let difficulty = 'easy';
      const difficultyConfig = {
        easy: 40, // 40个空格
        medium: 50, // 50个空格
        hard: 60, // 60个空格
      };

      // 初始化9x9网格
      function initializeGrid() {
        grid = Array(9)
          .fill()
          .map(() => Array(9).fill(0));
        solution = Array(9)
          .fill()
          .map(() => Array(9).fill(0));
      }

      // 检查数字在特定位置是否有效
      function isValid(num, row, col) {
        // 检查行
        for (let x = 0; x < 9; x++) {
          if (grid[row][x] === num) return false;
        }

        // 检查列
        for (let x = 0; x < 9; x++) {
          if (grid[x][col] === num) return false;
        }

        // 检查3x3方格
        let boxRow = Math.floor(row / 3) * 3;
        let boxCol = Math.floor(col / 3) * 3;
        for (let i = 0; i < 3; i++) {
          for (let j = 0; j < 3; j++) {
            if (grid[boxRow + i][boxCol + j] === num) return false;
          }
        }

        return true;
      }

      // 使用回溯算法解数独
      function solveSudoku(row = 0, col = 0) {
        if (col === 9) {
          row++;
          col = 0;
        }
        if (row === 9) return true;

        if (grid[row][col] !== 0) {
          return solveSudoku(row, col + 1);
        }

        let numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];
        shuffleArray(numbers); // 随机打乱数字顺序，生成不同的解

        for (let num of numbers) {
          if (isValid(num, row, col)) {
            grid[row][col] = num;
            if (solveSudoku(row, col + 1)) {
              return true;
            }
            grid[row][col] = 0;
          }
        }
        return false;
      }

      // Fisher-Yates 洗牌算法
      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      // 生成新的数独谜题
      function generatePuzzle() {
        initializeGrid();
        solveSudoku();
        // 保存完整解答
        for (let i = 0; i < 9; i++) {
          for (let j = 0; j < 9; j++) {
            solution[i][j] = grid[i][j];
          }
        }

        // 根据难度移除数字
        let cellsToRemove = difficultyConfig[difficulty];
        while (cellsToRemove > 0) {
          let row = Math.floor(Math.random() * 9);
          let col = Math.floor(Math.random() * 9);
          if (grid[row][col] !== 0) {
            grid[row][col] = 0;
            cellsToRemove--;
          }
        }
      }

      // 更新显示
      function updateDisplay() {
        const gridElement = document.getElementById('grid');
        gridElement.innerHTML = '';

        for (let i = 0; i < 9; i++) {
          for (let j = 0; j < 9; j++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            if (grid[i][j] !== 0) {
              cell.textContent = grid[i][j];
              if (solution[i][j] === grid[i][j]) {
                cell.classList.add('fixed');
              }
            }

            cell.addEventListener('click', () => selectCell(i, j));
            gridElement.appendChild(cell);
          }
        }
      }

      // 选择单元格
      function selectCell(row, col) {
        if (selectedCell) {
          document.querySelectorAll('.cell').forEach(cell => cell.classList.remove('selected'));
        }
        selectedCell = { row, col };
        const cells = document.querySelectorAll('.cell');
        cells[row * 9 + col].classList.add('selected');
      }

      // 设置数字
      function setNumber(num) {
        if (!selectedCell) return;
        const { row, col } = selectedCell;

        // 如果是固定的数字，不允许修改
        if (solution[row][col] === grid[row][col]) return;

        grid[row][col] = num === 0 ? 0 : num;
        updateDisplay();

        // 检查是否完成
        if (isGridFull() && isSolutionCorrect()) {
          showMessage('恭喜！你已完成数独！', 'success');
          clearInterval(timerInterval);
        }
      }

      // 检查是否填满
      function isGridFull() {
        return grid.every(row => row.every(cell => cell !== 0));
      }

      // 检查解答是否正确
      function isSolutionCorrect() {
        for (let i = 0; i < 9; i++) {
          for (let j = 0; j < 9; j++) {
            if (grid[i][j] !== solution[i][j]) return false;
          }
        }
        return true;
      }

      // 检查当前解答
      function checkSolution() {
        let isCorrect = true;
        const cells = document.querySelectorAll('.cell');

        for (let i = 0; i < 9; i++) {
          for (let j = 0; j < 9; j++) {
            if (grid[i][j] !== 0 && grid[i][j] !== solution[i][j]) {
              cells[i * 9 + j].classList.add('error');
              isCorrect = false;
            } else {
              cells[i * 9 + j].classList.remove('error');
            }
          }
        }

        if (!isCorrect) {
          showMessage('还有错误需要修正', 'error');
        }
      }

      // 显示/隐藏答案
      let isShowingSolution = false;
      let savedGrid = null;

      function showSolution() {
        if (!isShowingSolution) {
          // 保存当前状态
          savedGrid = grid.map(row => [...row]);
          // 显示答案
          for (let i = 0; i < 9; i++) {
            for (let j = 0; j < 9; j++) {
              grid[i][j] = solution[i][j];
            }
          }
          document.querySelector('button[onclick="showSolution()"]').textContent = '隐藏答案';
          isShowingSolution = true;
        } else {
          // 恢复保存的状态
          grid = savedGrid.map(row => [...row]);
          document.querySelector('button[onclick="showSolution()"]').textContent = '显示答案';
          isShowingSolution = false;
        }
        updateDisplay();
      }

      // 显示消息
      function showMessage(text, type) {
        const messageElement = document.getElementById('message');
        messageElement.textContent = text;
        messageElement.className = `message ${type}`;
        messageElement.style.display = 'block';
        setTimeout(() => {
          messageElement.style.display = 'none';
        }, 3000);
      }

      // 更新计时器显示
      function updateTimer() {
        const minutes = Math.floor(timer / 60);
        const seconds = timer % 60;
        document.getElementById('timer').textContent = `${minutes.toString().padStart(2, '0')}:${seconds
          .toString()
          .padStart(2, '0')}`;
      }

      // 开始新游戏
      function newGame() {
        clearInterval(timerInterval);
        timer = 0;
        updateTimer();
        difficulty = document.getElementById('difficulty').value;
        generatePuzzle();
        updateDisplay();
        // 重置显示答案状态
        isShowingSolution = false;
        savedGrid = null;
        document.querySelector('button[onclick="showSolution()"]').textContent = '显示答案';
        timerInterval = setInterval(() => {
          timer++;
          updateTimer();
        }, 1000);
      }

      // 键盘输入支持
      document.addEventListener('keydown', e => {
        if (!selectedCell) return;

        if (e.key >= '1' && e.key <= '9') {
          setNumber(parseInt(e.key));
        } else if (e.key === 'Backspace' || e.key === 'Delete' || e.key === '0') {
          setNumber(0);
        }
      });

      // 响应式处理
      function handleResize() {
        const vw = Math.min(window.innerWidth, window.parent?.innerWidth || window.innerWidth);
        const vh = Math.min(window.innerHeight, window.parent?.innerHeight || window.innerHeight);

        // 动态计算尺寸
        const maxWidth = Math.min(vw - 40, 600);
        const cellSize = Math.max(25, Math.min(maxWidth / 12, 50));
        const fontSize = Math.max(10, Math.min(vw * 0.02, 16));

        // 动态创建CSS样式
        const style = document.createElement('style');
        style.textContent = `
          :root {
            --cell-size: ${cellSize}px !important;
            --font-size-normal: ${fontSize}px !important;
          }
          .game-container {
            width: ${Math.min(95, (maxWidth / vw) * 100)}% !important;
            max-width: ${maxWidth}px !important;
          }
          .sudoku-grid {
            grid-template-columns: repeat(9, ${cellSize}px) !important;
            grid-template-rows: repeat(9, ${cellSize}px) !important;
          }
          .cell {
            width: ${cellSize}px !important;
            height: ${cellSize}px !important;
            font-size: ${Math.max(10, cellSize * 0.6)}px !important;
          }
        `;
        document.head.appendChild(style);
      }

      window.addEventListener('resize', handleResize);

      // iframe环境特殊处理
      if (window.parent !== window) {
        window.parent.addEventListener('resize', handleResize);
        setInterval(handleResize, 1000);
      }

      // 初始化游戏
      newGame();
      handleResize(); // 初始化时设置正确的尺寸
    </script>
  </body>
</html>







